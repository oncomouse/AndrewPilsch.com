%meta{ :charset => "utf-8" }/
%title
	- if current_page
		- if current_page.data.has_key? "title"
			- page_title =  current_page.data["title"]
		- else
			- page_title = "Andrew Pilsch Blog"
			- if !/index.html/.match(current_page.source_file)
				- page_title += " - "
			- if current_page.respond_to? :title
				- page_title +=  "#{current_page.title}"
			-elsif current_page.data.has_key? "title"
				- page_title +=  "#{current_page.data["title"]}"
			- elsif current_page.source_file =~ /tag.html/
				- page_title +=  "Articles Tagged \"#{tagname}\""
			- elsif current_page.source_file =~ /calendar.html/
				- page_title += "Archive for"
				- case page_type
					- when 'day'
						- page_title +=  Date.new(year, month, day).strftime('%b %e %Y')
					- when 'month'
						- page_title +=  Date.new(year, month, 1).strftime('%b %Y')
					- when 'year'
						- page_title +=  year.to_s
	- else
		= page_title "Andrew Pilsch Blog"
	= page_title
- page_description = nil
-if current_page.data.has_key? "description"
	- page_description = Haml::Filters::Markdown.render(current_page.data["description"])
-elsif current_page.respond_to? :summary
	- page_description = current_page.summary
-if not page_description.nil?
	- page_description = Nokogiri::HTML(page_description).text.gsub(/\'/,"\\'")
	%meta{ :name => "description", :content => "#{page_description}" }
- page_image = "https://pbs.twimg.com/profile_images/2957834955/e050ad2c2d80708d2ede6a1287076d61_400x400.png"
- if current_page.respond_to? :body
	- nokogiri_img = Nokogiri::HTML(current_page.body).css('img.splash')
	- if nokogiri_img.length > 0
		- page_image = image_path(nokogiri_img.first.attribute "src")
/ Open Graph Stuff
%meta{ :name => "og:url", :content => "http://andrew.pilsch.com#{current_page.url}" }
-if page_description.nil?
	- page_description = "Andrew Pilsch's Blog"
%meta{ :name => "og:description", :content=> page_description }
%meta{ :name => "og:title", :content => page_title }
%meta{ :name => "og:image", :content => page_image }

%meta{ :name => "viewport", :content => "width=device-width, initial-scale=1.0" }/
%link{ :href => "/blog/feed.xml", :rel => "alternate", :type =>"application/atom+xml" }/
/ Load Fonts
= stylesheet_link_tag("fonts/genericons/genericons.css", :media => "all", :rel => "stylesheet" )
= stylesheet_link_tag("http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic", :media => "all and (min-width: 33.236em)", :rel => "stylesheet" )
/ Pygments Support
= stylesheet_link_tag("blog/pygments.css", :media => "all", :rel => "stylesheet" )
/ Three Bears Structure
= stylesheet_link_tag("blog/global.css", :media => "all", :rel => "stylesheet" )
= stylesheet_link_tag("blog/layout.css", :media => "all and (min-width: 33.236em)", :rel => "stylesheet" )